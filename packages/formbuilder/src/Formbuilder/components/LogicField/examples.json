[
    {
        "file": "ah_twic_baseline",
        "relevant": [
            "./source = ‘user’",
            "${warn_symptom} = '2'"
        ],
        "calculation": [
            "../inputs/contact/_id",
            "../inputs/contact/patient_id",
            "../inputs/contact/name",
            "${chol_status}",
            "${aht_twic_eligibility}"
        ]
    },
    {
        "file": "bp_int",
        "relevant": [
            "${hypertensive_urgency}='1' or ${hypertensive_emergency}='1'",
            "${hypertensive_urgency}='1' or ${hypertensive_emergency}='1'",
            "${hypertensive_emergency}='1'",
            "${hypertensive_emergency}='1'",
            "${hypertensive_emergency}='1'",
            "${sup_call_highbp_yn}='yes'",
            "${sup_call_highbp_name}='other'",
            "${sup_call_highbp_yn}='no'",
            "(${hypertensive_urgency}='1' or ${hypertensive_emergency}='1') and ${aht_tx}='yes' and ${sup_call_highbp_yn}='no'",
            "(${hypertensive_urgency}='1' or ${hypertensive_emergency}='1') and ${aht_tx}='yes' and ${sup_call_highbp_yn}='no'",
            "(${hypertensive_urgency}='1' or ${hypertensive_emergency}='1') and ${aht_tx}='no' and ${sup_call_highbp_yn}='no'",
            "(${hypertensive_urgency}='1' or ${hypertensive_emergency}='1') and ${aht_tx}='no' and ${sup_call_highbp_yn}='no'",
            "${pregnant}='yes' and ${pregnant}!='' and (selected(${aht_drugs}, 'Losartan') or selected(${aht_drugs}, 'Lisinopril') or selected(${aht_drugs}, 'Enalapril')  or selected(${aht_drugs}, 'Telmisartan') or selected(${aht_drugs}, 'Captopril'))",
            "${aht_dxs}='diagnosed' and ${pregnant}='yes' and ${pregnant}!='' and ${aht_tx}='no' and (${sys_avg}>= 140 or ${dia_avg}>=90)",
            "${aht_dxs}='diagnosed' and ${pregnant}='yes' and ${pregnant}!='' and ${aht_tx}='yes'",
            "${pregnant}='yes' and ${pregnant}!=''",
            "${aht_dxs}='diagnosed' and ${pregnant}='refused' and ${pregnant}!=''",
            "${equ_cons}='1' and ${equ_cons}!='' and ${hypertensive_emergency}!='1' and ${hypertensive_urgency}!='1'",
            "${aht_dxs}='screen_normal' or (${aht_dxs}='highnormal' and ${t_aht_dxs}='awaiting_confirm') and (${t_heart_failure}!='1' and ${t_heart_failure}!='yes' and not(selected(${cesi_type},'heart_failure')) and not(selected(${aht_drugs}, 'Lasix')) and not(selected(${aht_drugs}, 'Aldactone')))",
            "((${aht_dxs}='screen_normal' or ${aht_dxs}='highnormal') and ${t_aht_dxs}='diagnosed') and (${t_heart_failure}!='1' and ${t_heart_failure}!='yes' and not(selected(${cesi_type},'heart_failure')) and not(selected(${aht_drugs}, 'Lasix')) and not(selected(${aht_drugs}, 'Aldactone')))",
            "(((${t_heart_failure}='1' or ${t_heart_failure}='yes') and ${t_heart_failure}!='') or (selected(${cesi_type}, 'heart_failure')) or (selected(${aht_drugs}, 'Lasix')) or (selected(${aht_drugs}, 'Aldactone'))) and (${amlohct_dose_rec}='0' or ${amlohct_dose_rec}='na')",
            "${aht_dxs}='highnormal' and (${t_aht_dxs}='awaiting_screening' or ${t_aht_dxs}='')",
            "${aht_dxs}='awaiting_confirm' and ${sys_avg} < 180 and ${dia_avg} < 110 and ${sys_avg}!='' and ${dia_avg}!='' and ${t_aht_dxs}!='diagnosed' and ${bp_cat_tx}!='conflicting' and ${warn_symp}!='1'",
            "${aht_dxs}='awaiting_confirm' and ${sys_avg} < 180 and ${dia_avg} < 110 and ${sys_avg}!='' and ${dia_avg}!='' and ${t_aht_dxs}='diagnosed'",
            "${sys_avg_c} < 140 and ${dia_avg_c} < 90 and ${sys_avg_c} !='' and ${dia_avg_c} !='' and ${aht_dxs}='awaiting_confirm'",
            "(${sys_avg_c} >= 140 or ${dia_avg_c} >= 90) and ${sys_avg_c} < 180 and ${dia_avg_c} < 120 and ${aht_dxs}='awaiting_confirm'",
            "(${sys_avg_c} >= 180 or ${dia_avg_c} >= 120) and ${sys_avg_c} !='' and ${dia_avg_c} !='' and ${aht_tx}='no'",
            "(${sys_avg} >= 140 or ${dia_avg} >= 90) and ${sys_avg} !='' and ${dia_avg} !='' and ${aht_tx}='yes' and ${bp_cat_tx}!='conflicting'",
            "(${sys_avg} >= 140 or ${dia_avg} >= 90) and ${sys_avg} !='' and ${dia_avg} !='' and ${aht_tx}='no' and ${aht_dxs}='diagnosed' and ${bp_cat_tx}!='conflicting'",
            "${sys_avg} < 120 and ${sys_avg} !='' and ${dia_avg} !='' and ${dia_avg}<90 and ${aht_tx}='yes' and (${t_heart_failure}!='1' and ${t_heart_failure}!='yes' and not(selected(${cesi_type},'heart_failure')) and not(selected(${aht_drugs}, 'Lasix')) and not(selected(${aht_drugs}, 'Aldactone')))",
            "(${sys_avg} < 140 and ${sys_avg} >= 120 and ${dia_avg} < 90) and ${sys_avg} !='' and  ${dia_avg} !='' and ${aht_tx}='yes'",
            "${sys_avg} < 120 and ${sys_avg} !='' and ${dia_avg} !='' and ${aht_tx}='yes' and (${pregnant}='' or ${pregnant}='no') and (${amlohct_dose_rec}='0' or ${amlohct_dose_rec}='na') and (${t_heart_failure}!='1' and ${t_heart_failure}!='yes' and not(selected(${cesi_type},'heart_failure')) and not(selected(${aht_drugs}, 'Lasix')) and not(selected(${aht_drugs}, 'Aldactone')))",
            "${warn_symp}='1'"
        ],
        "calculation": [
            "if(${ci_amlohct}='yes', '1', '2')",
            "jr:choice-name(${aht_vhw_care},'${aht_vhw_care}')",
            "if(${aht_dxs}!='diagnosed', 'na', if(${hypertensive_emergency}='1' or (${warn_symp}='1' and ${warn_symp}!=''), 'fac_care_alarm', if(${pregnant}='yes' or ${pregnant}='refused' or ${aht_vhw_care}='3' or (${amlohct_approval}='no' and ${amlohct_approval}!='') or ${bp_status}='refused' or (${aht_tx}='yes' and ${aht_tx_refill}!='com' and ${bp_status}!='active') or ((((${t_heart_failure}='1' or ${t_heart_failure}='yes') and ${t_heart_failure}!='') or (selected(${cesi_type}, 'heart_failure')) or (selected(${aht_drugs}, 'Lasix')) or (selected(${aht_drugs}, 'Aldactone'))) and (${amlohct_dose_rec}='0' or ${amlohct_dose_rec}='na')), 'fac_care', if(${amlohct_dose_rec}='0', 'zero_dose', if(${aht_vhw_care}='2', 'considering', if(${amlohct_av}='no', 'unavailable', if(${aht_tx}='no' and (${bp_status}='unavailable' or ${bp_status}='considering'), 'requiring_measurement', if(selected(${aht_drugs}, 'Amlodipin_HCTz') and ${amlohct_dose_cur}='10_25' and (${bp_cat_tx}='high' or ${bp_cat_tx}='very_high') and ${adhdays_aht}='1' and ${adhdays_aht}!='', 'fac_care_refill', if(${bp_status}='active' and ((${amlohct_dose_rec}='5_125' and ${amlohct_dose_cur}='5_125' and ${aht_drugs}='Amlodipin_HCTz') or (${amlohct_dose_rec}='10_25' and ${amlohct_dose_cur}='10_25' and ${aht_drugs}='Amlodipin_HCTz')), 'active_stable', if((${amlohct_dose_rec}='5_125' and (${amlohct_dose_cur}!='5_125' or ${aht_drugs}!='Amlodipin_HCTz')) or ((${amlohct_dose_rec}='10_25' or ${amlohct_dose_rec}='10_25_high') and (${amlohct_dose_cur}!='10_25' or ${aht_drugs}!='Amlodipin_HCTz')), 'active_adjusted', ${t_aht_txs}))))))))))",
            "if(${aht_txs}!='fac_care', 'na', if(${pregnant}='yes' or ${pregnant}='refused', 'pregnant', if(${bp_status}='refused' or ${aht_vhw_care}='3', 'refused', if((${aht_tx_cat}='triple' and ${amlohct_approval}='no') or ((${aht_drugs}='Amlodipin_HCTz' and ${amlohct_dose_cur}='10_25') and ${bp_cat_tx}='high' and ${adhdays_aht}='1' and ${adhdays_aht}!=''), 'comp_tx', if(((${t_heart_failure}='1' or ${t_heart_failure}='yes') and ${t_heart_failure}!='') or selected(${cesi_type}, 'heart_failure') or selected(${aht_drugs}, 'Lasix') or selected(${aht_drugs}, 'Aldactone'), 'heart_failure', if(((${amlohct_ci}='1' and ${amlohct_ci}!='') or (${aht_se_stop}='1' and ${aht_se_stop}!='') or (${t_aht_fc_rsn}='intolerant' and not(selected(${aht_drugs}, 'Amlodipin_HCTz')))) and ${amlohct_approval}='no', 'intolerant', if(${bp_status}='unavailable' or ${bp_status}='considering', 'requiring_measurement', ${t_aht_fc_rsn})))))))",
            "if(${aht_dxs}!='diagnosed' or ${aht_txs}='fac_care' or ${aht_txs}='considering' or ${aht_txs}='requiring_measurement', 'na', if(${amlohct_dose_rec}='0', '0', if(${amlohct_dose_rec}='10_25', '10_25', if(${amlohct_dose_rec}='5_125', '5_125', ${t_amlohct_dose}))))",
            "if(int(decimal-date-time(${date_last_vis}) - decimal-date-time ('2024-09-14')) < '0' and ${t_aht_twic_status}='' and ${aht_dxs}='diagnosed' and ${pregnant}!='yes'  and ${pregnant}!='refused' and (${warn_symp}='2' or ${warn_symp}='') and (${equ_cons}='1' and ${equ_cons}!=''), 'eligible', if((${warn_symp}='2' or ${warn_symp}='') and ${days_btw_ahtenrol_now} >= '300' and ${days_btw_ahtenrol_now} < '1000' and (${t_aht_twic_status} = 'eligible' or ${t_aht_twic_status}='6m_complete' or ${t_aht_twic_status}='12m_complete'), '12m_complete', if((${warn_symp}='2' or ${warn_symp}='') and ${days_btw_ahtenrol_now}  >= '150' and ${days_btw_ahtenrol_now}  < '1000' and (${t_aht_twic_status} = 'eligible' or ${t_aht_twic_status}='6m_complete'), '6m_complete', ${t_aht_twic_status})))",
            "if(${ci_atorva}!='' and (selected(${ci_atorva},'liver_problem') or selected(${ci_atorva},'kidney_problem') or selected(${ci_atorva},'allergy')), '1', '2')",
            "jr:choice-name(${ator_rdy},'${ator_rdy}')",
            "if(${cvd_risk}!='1', 'na', if(${stat_approval}='no' and ${stat_approval}!='', 'intolerant', if(${atorva_available}='no', 'unavailable', if(${ator_rdy}='2','considering', if(${ator_rdy}='3' ,'refused', if(${ator_rdy}='1' and ${ator_rdy}!='','active', ${t_atorva_stat}))))))",
            "jr:choice-name(${ass_rdy},'${ass_rdy}')",
            "if(${ass_rec}!='1', 'na', if(${ass_approval}='no' and ${ass_approval}!='', 'intolerant', if(${ass_available}='no', 'unavailable', if(${ass_rdy}='2','considering', if(${ass_rdy}='3' ,'refused', if(${ass_rdy}='1' and ${ass_rdy}!='','active',${t_ass_stat}))))))",
            "jr:choice-name(${bmqgo1},'${bmqgo1}')",
            "jr:choice-name(${bmqgo2},'${bmqgo2}')",
            "jr:choice-name(${bmqgo3},'${bmqgo3}')",
            "jr:choice-name(${bmqgo4},'${bmqgo4}')",
            "jr:choice-name(${bmqgh1},'${bmqgh1}')",
            "jr:choice-name(${bmqgh2},'${bmqgh2}')",
            "jr:choice-name(${bmqgh3},'${bmqgh3}')",
            "jr:choice-name(${bmqsn1},'${bmqsn1}')",
            "jr:choice-name(${bmqsn2},'${bmqsn2}')",
            "jr:choice-name(${bmqsn3},'${bmqsn3}')",
            "jr:choice-name(${bmqsn4},'${bmqsn4}')",
            "jr:choice-name(${bmqsn5},'${bmqsn5}')",
            "jr:choice-name(${bmqsc1},'${bmqsc1}')",
            "jr:choice-name(${bmqsc2},'${bmqsc2}')",
            "jr:choice-name(${bmqsc3},'${bmqsc3}')",
            "jr:choice-name(${bmqsc4},'${bmqsc4}')",
            "jr:choice-name(${bmqsc5},'${bmqsc5}')",
            "jr:choice-name(${eq5d_mob},'${eq5d_mob}')",
            "jr:choice-name(${eq5d_sc},'${eq5d_sc}')",
            "jr:choice-name(${eq5d_us},'${eq5d_us}')",
            "jr:choice-name(${eq5d_pain},'${eq5d_pain}')",
            "jr:choice-name(${eq5d_anx},'${eq5d_anx}')",
            "format-date(date(decimal-date-time(${date_last_vis})-(180)), '%d-%b-%Y')",
            "jr:choice-name(${junk_fruit},'${junk_fruit}')",
            "jr:choice-name(${junk_sugdrink},'${junk_sugdrink}')",
            "jr:choice-name(${junk_candy},'${junk_candy}')",
            "jr:choice-name(${junk_biscuit},'${junk_biscuit}')",
            "jr:choice-name(${junk_chocolate},'${junk_chocolate}')",
            "jr:choice-name(${junk_crisps},'${junk_crisps}')",
            "jr:choice-name(${junk_atchar},'${junk_atchar}')",
            "jr:choice-name(${junk_fries},'${junk_fries}')",
            "jr:choice-name(${junk_makoenya},'${junk_makoenya}')",
            "jr:choice-name(${junk_fish},'${junk_fish}')",
            "jr:choice-name(${junk_meat},'${junk_meat}')",
            "jr:choice-name(${salt_cook},'${salt_cook}')",
            "jr:choice-name(${salt_eat},'${salt_eat}')",
            "jr:choice-name(${salt_red},'${salt_red}')",
            "jr:choice-name(${salt_prob},'${salt_prob}')",
            "jr:choice-name(${salt_food},'${salt_food}')",
            "jr:choice-name(${salt_quant},'${salt_quant}')",
            "jr:choice-name(${alc_freq},'${alc_freq}')",
            "jr:choice-name(${alc_drunk},'${alc_drunk}')"
        ]
    }
]